<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Governor Trends & Analytics | State Elections Tracker</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;600;700;800&family=Merriweather:wght@300;400;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/common.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
<style>
  .subnav {
    display: flex;
    gap: 8px;
    margin-bottom: 32px;
    flex-wrap: wrap;
  }
  .subnav a {
    display: inline-block;
    padding: 8px 18px;
    border: 2px solid var(--ms-border);
    border-radius: var(--ms-radius);
    font-family: 'Work Sans', sans-serif;
    font-weight: 600;
    font-size: 13px;
    text-decoration: none;
    color: var(--ms-text-light);
    transition: all 0.15s;
  }
  .subnav a:hover { border-color: var(--ms-navy); color: var(--ms-navy); }
  .subnav a.active { background: var(--ms-navy); border-color: var(--ms-navy); color: white; }

  .stats-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    margin-bottom: 40px;
  }

  .chart-section { margin-bottom: 48px; }
  .chart-container {
    background: white;
    border: 1px solid var(--ms-border);
    border-radius: var(--ms-radius);
    padding: 24px;
    box-shadow: var(--ms-card-shadow);
  }
  .chart-container h3 {
    font-weight: 700;
    font-size: 16px;
    color: var(--ms-navy);
    margin-bottom: 4px;
  }
  .chart-container .chart-desc {
    font-size: 13px;
    color: var(--ms-text-light);
    margin-bottom: 16px;
  }
  .chart-wrap { position: relative; }

  /* Flips table */
  .flips-table {
    width: 100%;
    border-collapse: collapse;
    font-family: 'Work Sans', sans-serif;
    font-size: 13px;
  }
  .flips-table th {
    background: var(--ms-navy);
    color: white;
    padding: 8px 12px;
    text-align: left;
    font-weight: 700;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .flips-table td {
    padding: 6px 12px;
    border-bottom: 1px solid #eee;
  }
  .flips-table tr:hover td { background: #f8f9fa; }
  .flip-arrow { font-weight: 700; }
  .flip-d { color: var(--ms-dem-blue); }
  .flip-r { color: var(--ms-rep-red); }

  /* Streaks */
  .streaks-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
  }
  .streak-card {
    border: 1px solid var(--ms-border);
    border-radius: var(--ms-radius);
    padding: 16px;
  }
  .streak-card h4 {
    font-weight: 700;
    font-size: 14px;
    color: var(--ms-navy);
    margin-bottom: 8px;
  }
  .streak-item {
    display: flex;
    justify-content: space-between;
    padding: 4px 0;
    font-size: 13px;
    border-bottom: 1px solid #f0f0f0;
  }
  .streak-item:last-child { border-bottom: none; }
  .streak-years {
    font-weight: 600;
    color: var(--ms-text-light);
    font-size: 12px;
  }

  @media (max-width: 768px) {
    .stats-row { grid-template-columns: repeat(2, 1fr); }
    .streaks-grid { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>
<div class="page-container">

  <div class="site-header">
    <a href="index.html"><img src="assets/multistate-logomark.png" alt="MultiState"></a>
    <a href="index.html" class="site-title">State Elections Tracker</a>
  </div>

  <div class="breadcrumb">
    <a href="index.html">Home</a> &rsaquo; <a href="governors-101.html">Governors</a> &rsaquo; Trends &amp; Analytics
  </div>

  <div class="subnav">
    <a href="governors-101.html">Overview</a>
    <a href="governors.html">2026 Elections</a>
    <a href="governors-analytics.html" class="active">Trends & Analytics</a>
  </div>

  <h1 class="heading-xl" style="margin-bottom: 8px">Governor Trends & Analytics</h1>
  <p class="subtitle mb-16">Historical partisan balance, party flips, and gubernatorial trends since 1960</p>

  <!-- Stats -->
  <div class="stats-row" id="stats-row">
    <div class="card stat-card"><div class="stat-number" id="stat-terms">—</div><div class="stat-label">Governors Tracked</div></div>
    <div class="card stat-card"><div class="stat-number" id="stat-flips">—</div><div class="stat-label">Party Flips Since 1960</div></div>
    <div class="card stat-card"><div class="stat-number" id="stat-peak-d" style="color:var(--ms-dem-blue)">—</div><div class="stat-label">Peak Dem. Govs</div></div>
    <div class="card stat-card"><div class="stat-number" id="stat-peak-r" style="color:var(--ms-rep-red)">—</div><div class="stat-label">Peak GOP Govs</div></div>
  </div>

  <!-- Partisan Balance Chart -->
  <div class="chart-section">
    <div class="chart-container">
      <h3>Partisan Balance of Governors (1960&ndash;2026)</h3>
      <p class="chart-desc">Number of Democratic and Republican governors serving on January 15 of each year. Data from 628 historical governor terms.</p>
      <div class="chart-wrap">
        <canvas id="balanceChart" height="320"></canvas>
      </div>
    </div>
  </div>

  <!-- Flips by Decade Chart -->
  <div class="chart-section">
    <div class="chart-container">
      <h3>Party Flips by Decade</h3>
      <p class="chart-desc">Number of times the governor&rsquo;s office changed party in each decade, split by direction.</p>
      <div class="chart-wrap">
        <canvas id="flipsChart" height="280"></canvas>
      </div>
    </div>
  </div>

  <!-- Longest Streaks -->
  <div class="chart-section">
    <div class="chart-container">
      <h3>Longest Single-Party Streaks</h3>
      <p class="chart-desc">States with the longest unbroken runs of governors from one party (since 1960).</p>
      <div class="streaks-grid" id="streaks-grid"></div>
    </div>
  </div>

  <!-- Recent Flips Table -->
  <div class="chart-section">
    <div class="chart-container">
      <h3>Recent Party Flips (Since 2018)</h3>
      <p class="chart-desc">Every time the governor&rsquo;s office changed party hands.</p>
      <table class="flips-table" id="flips-table">
        <thead><tr><th>Year</th><th>State</th><th>Flip</th><th>New Governor</th></tr></thead>
        <tbody id="flips-tbody"></tbody>
      </table>
    </div>
  </div>

  <div class="site-footer" style="margin-top:32px">
    <img src="assets/multistate-logomark.png" alt="MultiState">
    <span class="footer-text">Source: MultiState (historical governor data via Wikipedia, Ballotpedia). Data generated <span id="gen-date"></span>.</span>
  </div>

</div>

<script src="js/common.js"></script>
<script>
(async function() {
  const data = await loadJSON('data/governor_history.json');
  const { yearly_balance, flips, terms } = data;

  document.getElementById('gen-date').textContent = formatDate(data.generated_at.split('T')[0]);

  // Stats
  document.getElementById('stat-terms').textContent = data.total_terms;
  document.getElementById('stat-flips').textContent = flips.length;

  // Only use reliable years (total governors >= 48)
  const reliableYears = yearly_balance.filter(y => (y.d + y.r + y.other) >= 48);
  const peakD = Math.max(...reliableYears.map(y => y.d));
  const peakR = Math.max(...reliableYears.map(y => y.r));
  const peakDYear = reliableYears.find(y => y.d === peakD).year;
  const peakRYear = reliableYears.find(y => y.r === peakR).year;
  document.getElementById('stat-peak-d').textContent = peakD + ' (' + peakDYear + ')';
  document.getElementById('stat-peak-r').textContent = peakR + ' (' + peakRYear + ')';

  // ── Partisan Balance Chart ──
  // Full range 1960-2026 (gap fixed via fix_governor_gaps.py)
  const chartYears = yearly_balance.filter(y => y.year >= 1960 && y.year <= 2026);

  new Chart(document.getElementById('balanceChart'), {
    type: 'line',
    data: {
      labels: chartYears.map(y => y.year),
      datasets: [
        {
          label: 'Democratic',
          data: chartYears.map(y => y.d),
          borderColor: '#276181',
          backgroundColor: 'rgba(39, 97, 129, 0.1)',
          fill: true,
          tension: 0.2,
          pointRadius: 0,
          pointHitRadius: 8,
          borderWidth: 2.5,
        },
        {
          label: 'Republican',
          data: chartYears.map(y => y.r),
          borderColor: '#e50963',
          backgroundColor: 'rgba(229, 9, 99, 0.1)',
          fill: true,
          tension: 0.2,
          pointRadius: 0,
          pointHitRadius: 8,
          borderWidth: 2.5,
        }
      ]
    },
    options: {
      responsive: true,
      interaction: { intersect: false, mode: 'index' },
      plugins: {
        legend: {
          position: 'top',
          labels: { font: { family: "'Work Sans', sans-serif", weight: '600', size: 12 }, usePointStyle: true, pointStyle: 'circle' }
        },
        tooltip: {
          backgroundColor: '#043858',
          titleFont: { family: "'Work Sans', sans-serif", weight: '700' },
          bodyFont: { family: "'Work Sans', sans-serif" },
          callbacks: {
            title: function(items) { return items[0].label; },
            label: function(item) { return item.dataset.label + ': ' + item.raw + ' governors'; }
          }
        }
      },
      scales: {
        y: {
          min: 0, max: 50,
          ticks: { font: { family: "'Work Sans', sans-serif", size: 11 } },
          grid: { color: '#f0f0f0' }
        },
        x: {
          ticks: {
            font: { family: "'Work Sans', sans-serif", size: 11 },
            maxTicksLimit: 15,
          },
          grid: { display: false }
        }
      }
    }
  });

  // ── Flips by Decade Chart ──
  const decades = ['1960s', '1970s', '1980s', '1990s', '2000s', '2010s', '2020s'];
  const decadeRanges = [[1960,1969],[1970,1979],[1980,1989],[1990,1999],[2000,2009],[2010,2019],[2020,2029]];
  const dToR = [], rToD = [];

  for (const [start, end] of decadeRanges) {
    const decadeFlips = flips.filter(f => f.year >= start && f.year <= end);
    dToR.push(decadeFlips.filter(f => f.from_party === 'D' && f.to_party === 'R').length);
    rToD.push(decadeFlips.filter(f => f.from_party === 'R' && f.to_party === 'D').length);
  }

  new Chart(document.getElementById('flipsChart'), {
    type: 'bar',
    data: {
      labels: decades,
      datasets: [
        {
          label: 'D → R',
          data: dToR,
          backgroundColor: '#e50963',
          borderRadius: 4,
        },
        {
          label: 'R → D',
          data: rToD,
          backgroundColor: '#276181',
          borderRadius: 4,
        }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'top',
          labels: { font: { family: "'Work Sans', sans-serif", weight: '600', size: 12 }, usePointStyle: true, pointStyle: 'rect' }
        },
        tooltip: {
          backgroundColor: '#043858',
          titleFont: { family: "'Work Sans', sans-serif", weight: '700' },
          bodyFont: { family: "'Work Sans', sans-serif" },
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: { font: { family: "'Work Sans', sans-serif", size: 11 }, stepSize: 5 },
          grid: { color: '#f0f0f0' }
        },
        x: {
          ticks: { font: { family: "'Work Sans', sans-serif", size: 11 } },
          grid: { display: false }
        }
      }
    }
  });

  // ── Longest Streaks ──
  // Compute per-state party streaks
  const byState = {};
  for (const t of terms) {
    if (!byState[t.state]) byState[t.state] = [];
    byState[t.state].push(t);
  }

  const streaks = [];
  for (const [st, stTerms] of Object.entries(byState)) {
    let currentParty = null;
    let streakStart = null;
    for (const t of stTerms) {
      if (!t.party) continue;
      if (t.party !== currentParty) {
        if (currentParty && streakStart) {
          const endYear = parseInt(t.start_date.substring(0, 4));
          const startYear = parseInt(streakStart.substring(0, 4));
          if (startYear >= 1950) {
            streaks.push({ state: st, state_name: t.state_name, party: currentParty, start: startYear, end: endYear, years: endYear - startYear });
          }
        }
        currentParty = t.party;
        streakStart = t.start_date;
      }
    }
    // Current ongoing streak
    if (currentParty && streakStart) {
      const startYear = parseInt(streakStart.substring(0, 4));
      if (startYear >= 1950) {
        streaks.push({ state: st, state_name: stTerms[stTerms.length - 1].state_name, party: currentParty, start: startYear, end: 2026, years: 2026 - startYear, ongoing: true });
      }
    }
  }

  streaks.sort((a, b) => b.years - a.years);

  const dStreaks = streaks.filter(s => s.party === 'D').slice(0, 8);
  const rStreaks = streaks.filter(s => s.party === 'R').slice(0, 8);

  const grid = document.getElementById('streaks-grid');

  function renderStreakCard(title, items, colorClass) {
    let html = '<div class="streak-card"><h4>' + title + '</h4>';
    for (const s of items) {
      const label = s.ongoing ? s.start + '–present' : s.start + '–' + s.end;
      html += '<div class="streak-item"><span>' + s.state_name + '</span><span class="streak-years">' + s.years + ' yrs (' + label + ')</span></div>';
    }
    html += '</div>';
    return html;
  }

  grid.innerHTML = renderStreakCard('Longest Democratic Streaks', dStreaks) + renderStreakCard('Longest Republican Streaks', rStreaks);

  // ── Recent Flips Table ──
  const recentFlips = flips.filter(f => f.year >= 2018).sort((a, b) => b.year - a.year || a.state.localeCompare(b.state));
  const tbody = document.getElementById('flips-tbody');

  for (const f of recentFlips) {
    const fromCls = f.from_party === 'D' ? 'flip-d' : 'flip-r';
    const toCls = f.to_party === 'D' ? 'flip-d' : 'flip-r';
    const tr = document.createElement('tr');
    tr.innerHTML =
      '<td>' + f.year + '</td>' +
      '<td>' + (STATE_NAMES[f.state] || f.state) + '</td>' +
      '<td><span class="flip-arrow ' + fromCls + '">' + f.from_party + '</span> → <span class="flip-arrow ' + toCls + '">' + f.to_party + '</span></td>' +
      '<td>' + f.new_governor + '</td>';
    tbody.appendChild(tr);
  }

})();
</script>
</body>
</html>
